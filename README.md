# 24点游戏求解器 - 深度学习项目

这是一个使用深度学习（T5模型）来解决24点数学游戏的项目。项目使用序列到序列（Seq2Seq）模型，将24点问题转换为后缀表达式（RPN）进行求解。

## 🎯 项目概述

- **目标**: 训练一个AI模型来解决24点游戏
- **模型**: T5-small (序列到序列模型)
- **输入格式**: `"solve: 1 2 3 4"`
- **输出格式**: 后缀表达式如 `"1 2 + 3 * 4 *"` 或 `<no_solution>`
- **数据集**: 包含有解和无解的24点问题

## 📁 项目结构

```
pythonProject1/
├── data24.py              # 数据生成器
├── train.py               # 原始训练脚本
├── train_improved.py      # 改进的训练脚本（推荐）
├── check_gpu.py           # GPU环境检查脚本
├── play.py                # 推理脚本
├── train.jsonl            # 训练数据
├── val.jsonl              # 验证数据
├── test.jsonl             # 测试数据
└── 24points_rpn_nosol/    # 模型输出目录
```

## 🔧 GPU训练支持

### ✅ 当前状态
**好消息：项目已经支持GPU训练！**

原始代码中的GPU支持：
- 自动检测CUDA可用性
- 支持BF16混合精度训练
- 自动设备管理

### 🚀 改进版本
我们提供了改进的训练脚本 `train_improved.py`，包含：
- 详细的GPU检测和配置
- 根据GPU内存自动调整批次大小
- 更好的错误处理和调试信息
- 优化的训练参数

## 🛠️ 使用指南

### 1. 环境检查
首先运行GPU环境检查：
```bash
python check_gpu.py
```

### 2. 数据生成（可选）
如果数据文件不存在，运行数据生成：
```bash
python data24.py
```

### 3. 模型训练
**推荐使用改进版本：**
```bash
python train_improved.py
```

**或使用原始版本：**
```bash
python train.py
```

### 4. 模型推理
训练完成后，使用推理脚本：
```bash
python play.py
```

## 🔍 GPU使用检查

### 如何确认GPU是否被使用：

1. **运行环境检查**：
   ```bash
   python check_gpu.py
   ```

2. **查看训练输出**：
   - 训练开始时会显示GPU信息
   - 模型会自动移动到GPU设备
   - 批次大小会根据GPU内存调整

3. **监控GPU使用**：
   ```bash
   nvidia-smi
   ```

### GPU配置建议：

| GPU内存 | 推荐批次大小 | 混合精度 |
|---------|-------------|----------|
| 24GB+   | 256         | BF16     |
| 16GB+   | 128         | BF16     |
| 8GB+    | 64          | FP16     |
| <8GB    | 32          | 无       |

## 📊 数据集信息

- **总样本数**: ~715个四元组组合
- **有解样本**: 约60%
- **无解样本**: 约40%
- **数据格式**: JSONL格式
- **训练/验证/测试**: 80%/10%/10%

## 🎮 24点游戏规则

使用4个数字（1-13），通过加减乘除运算得到24。例如：
- 输入: `1 2 3 4`
- 输出: `1 2 + 3 * 4 *` (表示 (1+2)×3×4 = 24)

## 🔧 环境要求

### 必需包：
```bash
pip install torch transformers datasets
```

### GPU支持（推荐）：
```bash
# CUDA 11.8版本
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

## 🚨 常见问题

### Q: 训练时出现CUDA内存不足错误
**A**: 减小批次大小或使用梯度累积：
```python
per_device_train_batch_size=32,  # 减小批次大小
gradient_accumulation_steps=8,   # 增加梯度累积步数
```

### Q: 如何确认模型在GPU上训练？
**A**: 查看训练输出中的设备信息：
```
模型设备: cuda:0
```

### Q: 训练速度很慢
**A**: 
1. 确认GPU是否被正确使用
2. 启用混合精度训练
3. 增加数据加载器工作进程数

## 📈 性能优化建议

1. **使用GPU**: 训练速度提升10-50倍
2. **混合精度**: 减少内存使用，提升训练速度
3. **批次大小**: 根据GPU内存调整
4. **数据加载**: 使用多进程数据加载

## 🤝 贡献

欢迎提交Issue和Pull Request来改进项目！

## 📄 许可证

本项目采用MIT许可证。 